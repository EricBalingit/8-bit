/*
	8-bit ver 0.4.1 alpha
	(c) 2013-2016 Epistemex
	www.epistemex.com
	Copyrighted. Preview version! No license given at this point.
*/
function _8bit(b,q){var n=this,B=k(q.width)?q.width:b.dataset.width||320,e=k(q.height)?q.height:b.dataset.height||240,a=b.getContext("2d",{alpha:!1}),g=new _8bit.Shaders.Pixelated(B,e,!0),A=new _8bit.Shaders.Pixelated(B,e),z=_8bit.utils.contextSupportAlphaOption(),v,x,m,i,r,y={stroke:0,fill:1,bg:2},o=function(){};if(!a){return}b.__is8=!0;this.strict=!0;this.aspect={};c("canvas",function(){return g.canvas});c("displayCanvas",function(){return b});c("displayWidth",function(){return b.width});c("displayHeight",function(){return b.height});c("width",function(){return B});c("height",function(){return e});c("ctx",function(){return a});c("globalAlpha",function(){return 1},o);c("globalCompositeOperation",function(){return g.ctx.globalCompositeOperation},s);c("imageSmoothingEnabled",function(){return x.imageSmoothingEnabled},function(h){x.imageSmoothingEnabled=!!h});c("imageSmoothingQuality",function(){return x.imageSmoothingQuality},function(h){x.imageSmoothingQuality=["low","medium","high"].indexOf(h)<0?"low":h});c("strokeStyle",function(){return x.styles[y.stroke].original},function(h){u(h,y.stroke)});c("fillStyle",function(){return x.styles[y.fill].original},function(h){u(h,y.fill)});c("bgStyle",function(){return x.styles[y.bg].original},function(h){u(h,y.bg)});c("palette",function(){return r},t);c("lineWidth",function(){return x.lineWidth},o);c("lineCap",function(){return x.lineCap},o);c("lineJoin",function(){return x.lineJoin},o);c("lineDashOffset",function(){return x.lineDashOffset},o);c("miterLength",function(){return x.miterLength},o);c("font",function(){return x.font},o);c("textAlign",function(){return x.textAlign},o);c("textBaseline",function(){return x.textBaseline},o);c("shadowOffsetX",function(){return x.shadowOffsetX},o);c("shadowOffsetY",function(){return x.shadowOffsetY},o);c("shadowBlur",function(){return x.shadowBlur},o);c("shadowColor",function(){return x.shadowColor},o);this.save=function(){v.push(x);x=new _8bit.State(r,x);return n};this.restore=function(){var h=v.splice(v.length-1)[0];if(h){x=h;m=x.matrix}return n};this.createPattern=function(h,w){return new _8bit.Pattern(h,w,n)};this.createLinearGradient=function(h,C,w,D){return new _8bit.Gradient("l",{x1:h,y1:C,x2:w,y2:D},n)};this.createRadialGradient=function(C,E,h,D,F,w){return new _8bit.Gradient("r",{x1:C,y1:E,r1:h,x2:D,y2:F,r2:w},n)};this.beginPath=function(){i=new _8bit.Path2D(m);return this};this.closePath=function(){i.closePath();return n};this.moveTo=function(h,w){i.moveTo(h,w);return n};this.lineTo=function(h,w){i.lineTo(h,w);return n};this.arc=function(E,F,C,D,w,h){i.arc(E,F,C,D,w,!!h);return n};this.arcTo=function(){i.arcTo.apply(i,arguments);return n};this.rect=function(E,F,D,C){i.rect(E,F,D,C);return n};this.ellipse=function(){i.ellipse.apply(i,arguments);return n};this.bezierCurveTo=function(h,C,w,D,E,F){i.bezierCurveTo(h,C,w,D,E,F);return n};this.quadraticCurveTo=function(h,w,C,D){i.quadraticCurveTo(h,w,C,D);return n};this.stroke=function(h){A.stroke((h||i).paths,x,n);A.drawToRender(g);g.drawToCtx(a,b.width,b.height);return n};this.fill=function(h,w){if(l(h)){w=h;h=null}A.fill((h||i).paths,x,n,w||"nonzero");A.drawToRender(g);g.drawToCtx(a,b.width,b.height);return n};this.clip=function(){};this.resetClip=function(){};this.drawImage=function(I,L,M,K,G,E,F,D,C){L|=0;M|=0;if(k(K)){K|=0;G|=0}if(k(E)){E|=0;F|=0;D|=0;C|=0}var H;if(I instanceof HTMLImageElement){if(arguments.length===9){var J=_8bit.utils.getContext(D,C,!0);J.drawImage(I,L,M,K,G,0,0,D,C);L=E;M=F;K=D;G=C;H=_8bit.Image.convert(J.canvas,K,G,n)}else{H=I.__8bit||_8bit.Image.convert(I,K||I.naturalWidth||I.width,G||I.naturalHeight||I.height,n)}I.__8bit=H}else{if(I instanceof HTMLVideoElement){H=_8bit.Image.convert(I,K||I.videoWidth||I.width,G||I.videoHeight||I.height,n)}else{if(I instanceof _8bit.Image){H=I.bitmap}}}A.drawImage(H,x,L,M);A.drawToRender(g);g.drawToCtx(a,b.width,b.height)};this.createImageData=function(D,C){return g.ctx.createImageData(D,C)};this.getImageData=function(E,F,D,C){return g.ctx.getImageData(E,F,D,C)};this.putImageData=function(h,w,C){g.ctx.putImageData(h,w,C);return n};this.clearRect=function(E,F,D,C){g.clearRect(E,F,D,C,x);g.drawToCtx(a,b.width,b.height);return n};this.strokeRect=function(F,G,E,C){var D=new _8bit.Path2D(m);D.rect(F,G,E,C);D.closePath();n.stroke(D);return n};this.fillRect=function(F,G,E,C){var D=new _8bit.Path2D(m);D.rect(F,G,E,C);D.closePath();n.fill(D);return n};this.fillText=o;this.strokeText=o;this.measureText=o;this.getTransform=function(){return m};this.setTransform=function(h,w,C,D,E,F){m.setTransform(h,w,C,D,E,F);return n};this.transform=function(h,w,C,D,E,F){m.transform(h,w,C,D,E,F);return n};this.rotate=function(h){m.rotate(h);return n};this.translate=function(h,w){m.translate(h,w);return n};this.scale=function(h,w){m.scale(h,w);return n};this.resetTransform=function(){m.reset();return n};this.resetClip=function(){if(!p()){}};this.createConicalGradient=function(h,w,C){if(!p()){}};this.circle=function(h,w,C){if(p()){n.moveTo(h+C,w);n.arc(h,w,C,0,Math.PI*2);n.closePath()}return n};this.line=function(h,C,w,D){if(p()){n.moveTo(h,C);n.lineTo(w,D)}return n};this.roundRect=function(F,G,E,C,D){if(p()){if(E-D*2<0){D=E*0.5}if(C-D*2<0){D=C*0.5}if(D<=0){return n.rect(F,G,E,C)}else{n.moveTo(F+E,G+C-D);n.arc(F+E-D,G+C-D,D,0,Math.PI*0.5);n.arc(F+D,G+C-D,D,Math.PI*0.5,Math.PI);n.arc(F+D,G+D,D,Math.PI,-Math.PI*0.5);n.arc(F+E-D,G+D,D,-Math.PI*0.5,0);n.closePath()}}return n};this.clear=function(){if(p()){n.clearRect(0,0,B,e)}return n};function u(w,h){x.styles[h]=new _8bit.Style(r,w,n.strict)}function t(h){r=new _8bit.Palette(h)}function s(w){var C=["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","xor","copy"],h=C.indexOf(w);g.ctx.globalCompositeOperation=h<0?C[0]:w}function f(){d();if(!z){a.globalCompositeOperation="copy"}n.palette=q.palette||_8bit.Palettes.CBM64;v=[];x=new _8bit.State(r);m=x.matrix;n.aspect={x:B/b.width,y:e/b.height};n.beginPath();n.clearRect(0,0,B,e)}f();b.addEventListener("resize",f);b.toDataURL=g.canvas.toDataURL.bind(g.canvas);b.toBlob=g.canvas.toBlob.bind(g.canvas);b.__8ael=b.addEventListener;b.__8rel=b.removeEventListener;b.addEventListener=function(E,D,C){var w=D.bind(b);function h(F){if(F instanceof MouseEvent){w(new _8bit.MouseEvent(b,n,F))}else{w(F)}}b.__8ael(E,h,C);b.removeEventListener=function(H,G,F){b.__8rel(H,h,F)}};function d(){_8bit.utils.disableSmoothing(a)}function p(){if(n.strict){console.warn("context.strict must be set to !1 for this method to work.")}return !n.strict}function k(h){return typeof h==="number"}function j(h){return typeof h==="boolean"}function l(h){return typeof h==="string"}function c(w,h,C){Object.defineProperty(n,w,C?{get:h,set:C}:{get:h})}}_8bit.Shaders={};if(typeof NO8BITPATCH==="undefined"){window.HTMLCanvasElement.prototype.___8GC=window.HTMLCanvasElement.prototype.getContext;window.HTMLCanvasElement.prototype.getContext=function(c,b){if(c.toLowerCase().replace("-","")==="8bit"){var a=new _8bit(this,b||{});return this.__is8?a:null}else{return this.___8GC(c,b)}};HTMLCanvasElement.prototype.___8PSC=HTMLCanvasElement.prototype.probablySupportsContext||null;HTMLCanvasElement.prototype.probablySupportsContext=function(a){if(a.toLowerCase().replace("-","")==="8bit"){return !0}if(this.___8PSC){return this.__is8?!1:this.___8PSC.apply(this,arguments)}else{return !this.__is8&&this.getContext.apply(this,arguments)!==null}}};_8bit.MouseEvent=function(b,c,d){var f=b.getBoundingClientRect(),g=d.clientX-f.left,h=d.clientY-f.top,a=c.aspect;this.x=(g*a.x)|0;this.y=(h*a.y)|0;this.clientX=f.left+this.x;this.clientY=f.top+this.y;this.altKey=d.altKey;this.button=d.button;this.buttons=d.buttons;this.ctrlKey=d.ctrlKey;this.metaKey=d.metaKey;this.shiftKey=d.shiftKey;this.relatedTarget=d.relatedTarget;this.target=d.target;this.currentTarget=d.currentTarget;this.eventPhase=d.eventPhase;this.timeStamp=d.timeStamp;this.type=d.type;this.isTrusted=!0;this.bubbles=d.bubbles;this.cancelable=d.cancelable;this.preventDefault=d.preventDefault.bind(d);this.stopPropagation=d.stopPropagation.bind(d);this.stopImmediatePropagation=d.stopImmediatePropagation.bind(d);this.originalEvent=d;this.region=null};_8bit.utils={getContext:function(e,b,d){var a=document.createElement("canvas");a.width=e;a.height=b;return a.getContext("2d",{alpha:!d})},contextSupportAlphaOption:function(){return document.createElement("canvas").getContext("2d",{alpha:!1}).getImageData(0,0,1,1).data[3]===255},disableSmoothing:function(a){var d=["i","webkitI","mozI","msI","oI","khtmlI"],b=0,c;while(c=d[b++]){if(typeof a[c+"mageSmoothingEnabled"]!=="undefined"){a[c+"mageSmoothingEnabled"]=!1;break}}}};_8bit.Style=function(b,c,a){this.original=c;if(typeof c==="string"){this.color=b.getNearestColor(_8bit.Color.fromCSS(c));this.style=this.color.toInt();this.type=_8bit.Style.type.solid}else{if(typeof c==="number"&&a){throw"Using index requires strict to be set to !1."}else{if(typeof c==="number"&&!a){c=Math.max(0,Math.min(b.length-1,c));this.color=b.lut[c];this.style=b._lutCache[c];this.type=_8bit.Style.type.solid}else{if(c instanceof _8bit.Pattern){this.type=_8bit.Style.type.pattern}else{if(c instanceof _8bit.Gradient){this.type=_8bit.Style.type.gradient}}}}}};_8bit.Style.type={solid:0,pattern:1,gradient:2};_8bit.State=function(a,b){this.styles=[new _8bit.Style(a,1,!1),new _8bit.Style(a,1,!1),new _8bit.Style(a,0,!1)];this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.lineDashPattern=[];this.lineDashOffset=0;this.miterLength=10;this.matrix=new _8bit.Matrix();this.textBaseline="baseline";this.textAlign="start";this.direction="LTR";this.font="10px sans-serif";this.shadowOffsetX=0;this.shadowOffsetY=0;this.shadowBlur=0;this.shadowColor="#000";this.globalCompositeOperation="source-over";this.imageSmoothingEnabled=!0;this.imageSmoothingQuality="low";if(b){this.init(b)}};_8bit.State.prototype={init:function(b){for(var a in b){if(b.hasOwnProperty(a)){this[a]=b[a]}}}};_8bit.Palettes={AMIGA:[0,0,16777215,11171670,16711680,16711935,16776960,16777215,8804,21740,1114006,48880,7895160,11184810,7902890,9874156],BW:[0,16777215],GREEN:[0,65280],CBM64:[0,16777215,13306,16769053,13781417,5356136,14173263,4517631,23551,16321,4092671,6316128,9211020,9961395,16750499,15120328],CBM64G:[0,16777215,2832232,11707504,8797551,4427096,7940149,7325624,2445167,14659,5859226,4473924,7105644,8704666,11886188,9803157],VIC20:[0,16777215,2238840,14538375,11952042,4825173,9253184,7524031,4813994,9024746,6449592,16777159,16162794,9035924,13398400,11730943],AMSTRADCPC:[0,8388608,16711680,128,8388736,16711808,255,8388863,16711935,32768,8421376,16744448,32896,8421504,16744576,33023,8421631,16744703,65280,8453888,16776960,65408,8454016,16777088,65535,8454143,16777215],APPLEII:[0,4204908,7877952,15744217,4216595,8421504,15767334,16299199,478016,1009881,8421504,12560620,1032998,8899263,12572307,16777215],ZXSPECTRUM:[0,12582912,192,12583104,49152,12632064,49344,12632256,0,16711680,255,16711935,65280,16776960,65535,16777215],BBC:[0,255,65280,16711680,16776960,16711935,65535,16777215],CGA:[0,11141120,43520,11184640,170,11141290,21930,11184810,5592405,16733525,5635925,16777045,5592575,16733695,5636095,16777215],MSX:[0,0,4831294,8245364,14701913,15824512,5332665,15719269,5858779,8227327,6210508,8900830,4301370,11888311,13421772,16777215],TELETEXT:[0,16711680,255,16711935,65280,16776960,65535,16777215],THOMSONMO5:[0,255,65280,65535,16711680,16711935,16776960,16777215,12303291,7829469,7855479,7855581,14514039,15628253,16777147,48110],NES:[8158332,16515072,12320768,12331076,8650900,2097320,4264,5256,12368,30720,26624,22528,5783552,0,0,0,12369084,16283648,16275456,16532584,13369560,5767396,14584,1072356,31916,47104,43008,4499456,8947712,0,0,0,16316664,16563260,16549992,16283800,16283896,9984248,5798136,4497660,47352,1636536,5560408,10025048,14215168,7895160,0,0,16579836,16573604,16300216,16300248,16300280,12625144,11587824,11067644,7919864,7928024,12122296,14219448,16579584,16308472,0,0],INTELLIVISION:[0,16750245,1129983,5773749,28244,5744384,2143487,11259849,16723456,16758820,5787391,13060284,4221752,8440693,5237498,16777215],GAMEBOY:[1917696,4025600,2341738,2411641],EGA:[0,11403337,2407936,11580160,192,11337930,177820,11446953,6160421,16711790,6470656,16752896,5898434,16646359,6206367,16750265,1204736,11486506,3538688,11730688,19384,11337923,2883396,11665248,6249472,16711775,6815488,16776960,5981115,16646353,6618955,16777085,98,11403382,2210816,11579648,255,11141375,43007,11311871,6094951,16711822,6404608,16752467,5439743,16580863,5809407,16680191,24144,11418985,3407616,11730688,255,11206911,327660,11468788,6182742,16711812,6749952,16776960,5505279,16580863,6225902,16777215],SEGA:[0,6160421,11403336,16646253,97,6029414,11403383,16646286,191,5898434,11206857,16646359,255,5505279,11141375,16515327,1270272,6183936,11420203,16646238,613456,6117206,11484264,16646274,19640,5915067,11337922,16646353,255,5505279,11206911,16449791,2407936,6405376,11580160,16752896,2145280,6339072,11514112,16751955,374173,6205856,11446696,16750265,43007,5744127,11245823,16614399,3538688,6815488,11796224,16776960,3407616,6815488,11730688,16776960,2883395,6487879,11599712,16777087,983020,6225902,11534324,16776959],AQUARIUS:[1906968,4077623,2162879,255,5627392,3866368,8323056,1441013,9306207,14614628,13435121,16580863,11580160,13686528,13618379,16777215],ATARI2600NTSC:[0,4867139,7630188,9867407,11841711,13355207,14605531,15592684,19521,1928541,3181947,4172436,4899755,5889218,6682329,7405548,6780,1523599,3037602,4421556,5475523,6463954,7256032,8573416,148,1380009,3424444,5069777,6387424,7638255,8692474,9943039,154,2162863,4194500,6110932,7625956,9140212,10719999,11970559,6488204,7930018,9175223,10496199,11751127,12740583,13731313,14720255,8323168,9764985,11010192,12265124,13520055,14509259,15499993,16554472,9044031,10289234,11534440,12791680,13783953,14774438,15568567,16557002,9306170,10551367,11796568,12795496,13852282,14842506,15570841,16559275,8585266,9836347,11354445,12608093,13598063,14586496,15576464,16630434,6629142,8342047,9856564,11633223,12884828,14136428,15388029,16638353,3688960,5465344,7177728,8955392,10207008,11722035,12972369,14221156,542720,3041280,5015552,6727936,8241723,9756500,11203445,12517254,410368,2778880,4491303,6005832,7520605,8772214,9958286,11206560,14635,2644039,4159582,5674105,7188878,8440485,9363134,10680272,11339,2247785,3763079,5015713,6267065,7518416,8573416,9561852],ATARI2600PAL:[0,4867139,7630188,9867407,11841711,13355207,14605531,15592684,23173,2651032,4491179,6266814,7778254,9028573,10540014,11789055,681776,3048260,4758620,6469745,7982213,9232787,10679969,11927478,12411,2575762,4416938,6259388,7771856,9022181,10534644,11785215,2454016,4361984,6072064,7782144,9294592,10741555,12252771,13500283,1507455,3801241,5636275,7421639,8936156,10448626,11962623,13213439,6644480,8157952,9671424,11184926,12435271,13422177,14672509,15659669,6488195,7995546,9240746,10497726,11752137,12741337,13732067,14786290,7878420,9393435,10842670,12159811,13411160,14661484,15649918,16638353,7798894,9240707,10748056,12002988,13258171,14509259,15499993,16554472,7798826,9316918,10832711,12086103,13336174,14588030,15576464,16630434,8781911,10027118,11272325,12528024,13520810,14510014,15566283,16554970,9306170,10551369,11796572,12792945,13784708,14839190,15567531,16555965],CBM16:[0,2827813,106,5258240,7536753,1202944,7667771,604438,105,8773,936192,2621548,2967808,7676959,7667797,1069568,0,4801346,1900684,7297792,9568407,1604352,9633879,743221,9353,16995,1272576,4653198,4942080,9717783,9633911,2716416,0,6840672,4012202,9337600,11468984,2727424,11546741,2259281,1067177,1794690,2460672,6625710,6916608,11561503,11403415,4625408,0,8814719,6118091,11311872,13435099,4439808,13522580,4168047,3631304,3965601,4369920,8668624,8890624,13601337,13377720,6599936,0,10722973,8157932,13351732,15466751,6349056,15562418,6076813,5736681,6005440,6278980,10577652,10865152,15510101,15421914,8574720,0,12762813,10132479,15260757,16601343,8322816,16686543,8051116,7776255,7848928,8122474,12617727,12905013,16764013,16678393,10549248,0,14737118,12304895,16776823,16616959,10157890,16696555,9960140,9752575,9822975,10092428,14659583,14876515,16774272,16624127,12582735,0,16776959,14411519,16777128,16700927,12058516,16706559,12058567,11990268,11993077,12058567,16700927,16777128,16777128,16700927,14417821],CBMP4:[0,2893349,4867139,6840929,8880511,10788766,12763070,14802910,16777215,106,1900683,4143275,6183629,8223726,10263551,12304895,14346239,5258240,7298048,9272320,11312128,13286449,15326295,16776824,16777127,7602290,9568406,11468984,13435100,15401215,16601599,16683263,16700927,940800,1670400,2727680,4505600,6414592,8322816,10223422,12124053,7602235,9633880,11546997,13522580,15562675,16751824,16762090,16772095,145688,416053,2193745,4168048,6142349,8051372,10025932,12058568,106,8842,411817,3631306,5736938,7776767,9883647,11924989,9030,17251,1794945,3900320,5940159,7914463,9889023,11993077,674304,1207040,2460672,4304128,6278726,8188012,10157966,12058568,2621547,4653198,6691503,8668625,10643187,12617983,14659583,16700927,2968064,4942336,6982144,8956160,10930688,12905265,14876513,16777127,7677215,9652501,11627038,13601592,15641174,16764269,16774273,16777127,7602261,9568374,11534487,13509817,15487962,16678393,16689663,16701439,807424,2716672,4691200,6665728,8640256,10614784,12582735,14483357],MSX2:[0,6160421,11403336,16646253,46,6094905,11403347,16580724,86,6094939,11403372,16646278,124,6029439,11403404,16646304,164,5898407,11403440,16646336,205,5832911,11272406,16580835,248,5701881,11206911,16580863,255,5505279,11141375,16515327,601856,6167833,11403331,16711787,11558,6166835,11403344,16646258,9808,6226008,11403369,16646276,4729,6029438,11337865,16646303,163,6029478,11403439,16646334,205,5832910,11337941,16580834,246,5701881,11206911,16580863,255,5505279,11141375,16515327,1135872,6311424,11414325,16711778,1070080,6245402,11414340,16711787,610629,6179661,11477601,16646270,19315,6046582,11404932,16646297,16799,5977761,11468971,16646331,11977,5906379,11403475,16646367,243,5767413,11272443,16580863,255,5570815,11141375,16449791,1604352,6256384,11429376,16661073,1538816,6256128,11429158,16726108,1341734,6190133,11494480,16724850,619878,6123881,11493241,16656528,29077,6056600,11360675,16646324,27072,5923269,11357900,16646362,23791,5724144,11287798,16580863,19711,5457151,11209471,16449791,2138880,6332928,11572736,16744232,2073344,6332416,11572480,16744506,1876736,6266368,11572263,16743517,1548359,6265938,11440485,16742273,367750,6199690,11439509,16741031,38839,6001849,11372736,16608719,37093,5868777,11370479,16605945,34559,5669887,11236351,16601855,2607872,6605056,11583744,16756992,2542336,6474240,11649280,16756736,2411008,6473728,11582976,16756525,2214144,6341888,11583039,16756071,1754480,6341490,11516800,16755350,508583,6209450,11450291,16754114,48601,6076894,11448804,16687088,46847,5813503,11381503,16619519,3077376,6681088,11726080,16769024,3011584,6615808,11725824,16768768,2946048,6615552,11725568,16768768,2748928,6615040,11725312,16768553,2486328,6483274,11659358,16767611,1961359,6482836,11527325,16767152,846282,6154188,11460819,16766176,58621,6087422,11459839,16699135,3538688,6815488,11796224,16776960,3538688,6749952,11796224,16776960,3407616,6749952,11730688,16776960,3276544,6749952,11665152,16776960,3079936,6553344,11665152,16777031,2752361,6487920,11599741,16777108,2162612,6356917,11599807,16777164,983020,6225902,11534324,16776959],WIN16:[0,393342,1146896,1409152,8324353,8323199,8356113,12632256,8421504,1507580,3014443,3473151,16454660,16515324,16711468,16777215],WIN20:[0,393342,1146896,1409152,8324353,8323199,8356113,12632256,12704961,15715239,15793151,10789024,8421504,1507580,3014443,3473151,16454660,16515324,16711468,16777215],MACII:[16777215,3473151,1926141,1245403,9961724,9897523,13176066,16554776,1747481,747018,471653,3630488,12303291,8947848,4473924,0],ACORN:[16777215,14540253,12303291,10066329,7829367,5592405,3355443,0,9913606,3206638,2280480,1245402,12447470,1345623,2734845,16628766],G_PACMAN:[0,16777215,5908000,555724,564172,6121694,1150836,281054,13155765,10634088,3834954],G_DONKEY:[0,16777215,5617919,26879,184],G_SPACEINV:[0,16777215,64256,2171135,15070672,4831206,621864,11210654,6687287],G_MONKEY:[0,16777215,10485759,3842047,4143674,4654336,12603439],G_MARIO:[0,16777215,609228,11188991,16487517,2259986,16776411,3442411,6247936,9804096,45128,15480863,15764063,12208375,15855097,12434877],G_ZELDA:[0,16777215,7895160,11980796,3375702,1654625,4759244,2385716,13171710,8202557,1782422,10580486,14266967,3849550,2639104,9550410]};_8bit.Palette=function(d,c){var b=0,a;this.lut=[];if(typeof d==="string"){d=d.toUpperCase();if(_8bit.Palettes[d]){c=d;d=_8bit.Palettes[d]}else{throw"Unknown palette name "+d}}this.name=c||"custom";while(b<d.length){a=d[b++];if(a instanceof _8bit.Color){this.lut.push(a)}else{if(typeof a==="number"){this.lut.push(new _8bit.Color(4278190080|a))}else{if(!Array.isArray(a)){throw"Invalid palette array at index "+ --b}this.lut.push(new _8bit.Color(a[0],a[1],a[2]))}}}this.length=this.lut.length;this._lutCache=new Uint32Array(this.length);for(b=0;a=this.lut[b];){this._lutCache[b++]=a.toInt()}};_8bit.Palette.prototype={getColor:function(a){if(a<0){a=0}if(a>=this.length){a=this.length-1}return this.lut[a]},getIndex:function(n,h,a,q){q=((q||0)*2.55+0.5)|0;var m=this.lut,f,l=0,p,o,k,j,e,d;if(q===0){for(;f=m[l];l++){if(n===f.r&&h===f.g&&a===f.b){return l}}}else{p=n-q;o=n+q;k=h-q;j=h+q;e=a-q;d=a+q;p=Math.max(0,Math.min(255,p));o=Math.max(0,Math.min(255,o));k=Math.max(0,Math.min(255,k));j=Math.max(0,Math.min(255,j));e=Math.max(0,Math.min(255,e));d=Math.max(0,Math.min(255,d));for(;f=m[l];l++){n=f.r;h=f.g;a=f.b;if(n>=p&&n<=o&&h>=k&&h<=j&&a>=e&&a<=d){return l}}}return -1},getNearestColor:function(e){var g=0,a,f,j=Number.MAX_VALUE,b,h=this.lut;while(a=h[g++]){f=e.diff(a);if(f<j){j=f;b=a}}return b},getNearestColorRGB:function(n,j,a){var k=0,e,h,m=Number.MAX_VALUE,f=0,l=this.lut;while(e=l[k++]){h=color.diffRGB(n,j,a);if(h<m){m=h;f=e}}return f}};_8bit.Color=function(d,c,a){if(arguments.length===1){c=this.int2rgb(d);this.r=c[0];this.g=c[1];this.b=c[2];this.int32=d}else{if(arguments.length===3){this.r=Math.min(Math.max(0,(d+0.5)|0),255);this.g=Math.min(Math.max(0,(c+0.5)|0),255);this.b=Math.min(Math.max(0,(a+0.5)|0),255);this.int32=this.rgb2int(this.r,this.g,this.b)}else{this.r=0;this.g=0;this.b=0;this.int32=0}}};_8bit.Color.fromCSS=function(d){var e=document.createElement("div"),c,f,b;e.style.cssText="width:1px;height:1px;position:fixed;left:-10px;top:-10px;background-color:"+d;document.body.appendChild(e);c=getComputedStyle(e).getPropertyValue("background-color");document.body.removeChild(e);f=c==="transparent"?"(0,0,0,0)":(c.substr(0,3)==="rgb"?c:"(0,0,0)");f=f.substring(f.indexOf("(")+1,f.length-1);b=f.split(",");return new _8bit.Color(+b[0],+b[1],+b[2])};_8bit.Color.prototype={add:function(a){return new _8bit.Color(this.r+a.r,this.g+a.g,this.b+a.b)},sub:function(a){return new _8bit.Color(this.r-a.r,this.g-a.g,this.b-a.b)},mix:function(d,h){var f=this*h+d.r*(1-h),e=this*h+d.r*(1-h),a=this*h+d.r*(1-h);return new _8bit.Color(f,e,a)},mul:function(a){return new _8bit.Color(this.r*a,this.g*a,this.b*a)},rshift:function(a){return new _8bit.Color(this.r>>a,this.g>>a,this.b>>a)},lshift:function(a){return new _8bit.Color(this.r<<a,this.g<<a,this.b<<a)},diff:function(a){var e=a.r-this.r,d=a.g-this.g,b=a.b-this.b;return e*e+d*d+b*b},diffRGB:function(h,f,a){var e=h-this.r,d=f-this.g,c=a-this.b;return e*e+d*d+c*c},diffSqrt:function(a){return Math.sqrt(this.diff(a))},threshold:function(b){var a=this.r*0.299+this.g*0.587+this.b*0.114;return a>=b?new _8bit.Color(255,255,255):new _8bit.Color(0,0,0)},invert:function(){return new _8bit.Color(255-this.r,255-this.g,255-this.b)},setRGB:function(d,c,a){this.r=d;this.g=c;this.b=a;this.int32=this.rgb2int(d,c,a);return this},setInteger:function(b){var a=this.int2rgb(b);this.int32=b;this.r=a[0];this.g=a[1];this.b=a[2];return this},rgb2int:function(d,c,a){return 4278190080|(a<<16)|(c<<8)|d},int2rgb:function(a){return[(a&255),(a&65280)>>>8,(a&16711680)>>>16]},toArray:function(){return[this.r,this.g,this.b]},toInt:function(){return this.int32},toObject:function(){return{r:this.r,g:this.g,b:this.b}},toString:function(){return this.r+","+this.g+","+this.b},toStyle:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},getToleranceRange:function(d){var a,b,c=0;a=[this.r,this.g,this.b];b=[this.r,this.g,this.b];for(;c<3;c++){a[c]-=(255*d+0.5)|0;b[c]+=(255*d+0.5)|0;if(a[c]<0){a[c]=0}if(b[c]>255){b[c]=255}}return{min:new _8bit.Color(a[0],a[2],a[3]),max:new _8bit.Color(b[0],b[2],b[3])}},clone:function(){return new _8bit.Color(this.r,this.g,this.b)}};_8bit.Gradient=function(o,k,d){var p=d.width,f=d.height,b=_8bit.utils.getContext(1,1),e,j,g,a,i=!0;e=o==="l"?b.createLinearGradient(k.x1,k.y1,k.x2,k.y2):b.createRadialGradient(k.x1,k.y1,k.r1,k.x2,k.x2,k.r2);this._sm=function(){this._getPixel=j.isIdentity()?l:n};this._getPixel=null;function n(h,m){var c=j.applyToPoint(h,m);h=c.x;m=c.y;return(h>=0&&h<p&&m>=0&&m<f)?a[m*p+h]:0}function l(c,h){return(c>=0&&c<p&&h>=0&&h<f)?a[h*p+c]:0}this._generate=function(h){var m=h.getTransform().inverse();if(!i&&m.isEqual(j)){return}j=m;i=!1;var c=_8bit.utils.getContext(p,f);c.fillStyle=e;c.fillRect(0,0,p,f);g=_8bit.Image.convert(c.canvas,p,f,h);a=new Uint32Array(g.data.buffer);this._sm()};this.addColorStop=function(h,c){e.addColorStop(h,c);return this}};_8bit.Pattern=function(q,u,b){if(typeof"repeat"==="undefined"){throw"Type Mismatch: repeat cannot be undefined"}var c=[i,k,m,f],d=[j,l,n,g],e,r=["repeat","repeat-x","repeat-y","no-repeat"].indexOf(u),t=b.palette,s=b.getTransform().inverse(),v,o,p,a;if(q instanceof HTMLImageElement){v=q.naturalWidth||q.width;o=q.naturalHeight||q.height;p=q.__8bit||_8bit.Image.convert(q,v,o,b);q.__8bit=p}else{if(q instanceof HTMLVideoElement){v=q.naturalWidth||q.width;o=q.naturalHeight||q.height;p=_8bit.Image.convert(q,v,o,t,b)}else{if(q instanceof _8bit.Image){v=q.width;o=q.height;p=q.bitmap}}}a=new Uint32Array(p.data.buffer);this.setTransform=function(h){s.reset();s.multiply(h.inverse());s.multiply(b.getTransform().inverse());e=s.isIdentity()?c:d;this._getPixel=e[r<0?0:r];return this};e=s.isIdentity()?c:d;this._getPixel=e[r<0?0:r];function i(h,w){h=h%v;w=w%o;return a[w*v+h]}function k(h,w){h=h%v;return(w>=0&&w<o)?a[w*v+h]:0}function m(h,w){w=w%o;return(h>=0&&h<v)?a[w*v+h]:0}function f(h,w){return(h>=0&&h<v&&w>=0&&w<o)?a[w*v+h]:0}function j(w,z){var h=s.applyToPoint(w,z);w=h.x%v;z=h.y%o;if(w<0){w+=v}if(z<0){z+=o}return a[z*v+w]}function l(w,z){var h=s.applyToPoint(w,z);w=h.x%v;z=h.y;if(w<0){w+=v}return(z>=0&&z<o)?a[z*v+w]:0}function n(w,z){var h=s.applyToPoint(w,z);w=h.x;z=h.y%o;if(z<0){z+=o}return(w>=0&&w<v)?a[z*v+w]:0}function g(w,z){var h=s.applyToPoint(w,z);w=h.x;z=h.y;return(w>=0&&w<v&&z>=0&&z<o)?a[z*v+w]:0}};_8bit.Path2D=function(a){this.paths=[new _8bit.Path2D.Path()];this.cp=0;this.step=0.025;this.matrix=a||new _8bit.Matrix();this.cx=0;this.cy=0};_8bit.Path2D.prototype={_new:function(){this.paths.push(new _8bit.Path2D.Path());this.cp=this.paths.length-1},addPath:function(c,a){var b,d=this.paths;if(a){c.paths.forEach(function(e){d.push(new _8bit.Path2D.Path(a.applyToArray(e.points)))});b=a.applyToPoint(c.cx,c.cy);this.cx=b.x;this.cy=b.y}else{this.paths=d.concat(c.paths);this.cx=c.cx;this.cy=c.cy}this._new()},moveTo:function(c,d,a){if(this.paths[this.cp].points.length){this._new()}var b=a?{x:c,y:d}:this.matrix.applyToPoint(c,d);this.paths[this.cp].add(b.x,b.y);this.cx=c;this.cy=d},closePath:function(){var a=this.paths[this.cp];if(a.points.length){a.isClosed=!0;this.moveTo(a.points[0],a.points[1],!0)}},lineTo:function(b,c){var a=this.matrix.applyToPoint(b,c);this.paths[this.cp].add(a.x,a.y);this.cx=b;this.cy=c},arc:function(j,k,g,h,b,a){var f=this.paths[this.cp],i=4/(Math.PI*g),c=f.points.length,d=this.matrix,e;h=h%(Math.PI*2);b=b%(Math.PI*2);if(g<0){throw new RangeError("IndexSizeError.")}if(a){if(h<b){b-=Math.PI*2}if(h===b){b-=Math.PI*2}for(;h>=b;h-=i){e=d.applyToPoint(j+g*Math.cos(h),k+g*Math.sin(h));f.add(e.x,e.y)}}else{if(h>b){b+=Math.PI*2}if(h===b){b+=Math.PI*2}for(;h<=b;h+=i){e=d.applyToPoint(j+g*Math.cos(h),k+g*Math.sin(h));f.add(e.x,e.y)}}this.cx=f.points[c-2];this.cy=f.points[c-1]},arcTo:function(o,v,p,w,f,g,e){if(f<0){throw new RangeError("IndexSizeError.")}if(typeof g==="number"){if(g<0){throw new RangeError("IndexSizeError.")}}else{g=f}if(typeof e!=="number"){e=0}var d=this.paths[this.cp],c=d.points.length,n=c>1?d.points[c-2]:o-1,u=c>1?d.points[c-1]:v-1,i=(v-u)/(o-n),k=(w-v)/(p-o),h=Math.atan((i-k)/(1+i*k)),m=f/Math.tan(h*0.5),q=Math.abs(Math.sqrt(m*m/(1+i*i))),x=Math.abs(q*i),r=o>n?o-q:o+q,y=v>u?v-x:v+x,j=-1/i,s,z,a,b;q=Math.abs(Math.sqrt(m*m/(1+k*k)));x=Math.abs(q*k);s=p>o?o+q:o-q;z=w>v?v+x:v-x;q=Math.abs(Math.sqrt(f*f/(1+j*j)));x=Math.abs(q*j);a=r+q;b=y+x;if(f===0){this.lineTo(o,v)}if(f===g){this.arc(a,b,f,Math.atan2(y-b,r-a),Math.atan2(z-b,s-a))}else{this.ellipse(a,b,f,g,e,Math.atan2(y-b,r-a),Math.atan2(z-b,s-a))}},ellipse:function(s,t,k,n,j,o,c,a){o=o%(Math.PI*2);c=c%(Math.PI*2);if(k<0||n<0){throw new RangeError("IndexSizeError.")}var i=this.paths[this.cp],f=i.points.length,r=2/(Math.PI*Math.min(k,n)),b=Math.cos(j),q=Math.sin(j),g=this.matrix,h,d,e;if(a){if(o<c){c-=Math.PI*2}for(;o>=c;o-=r){d=k*Math.cos(o);e=n*Math.sin(o);h=g.applyToPoint(s+b*d-q*e,t+q*d+b*e);i.add(h.x,h.y)}}else{if(o>c){c+=Math.PI*2}for(;o<=c;o+=r){d=k*Math.cos(o);e=n*Math.sin(o);h=g.applyToPoint(s+b*d-q*e,t+q*d+b*e);i.add(h.x,h.y)}}this.cx=i.points[f-2];this.cy=i.points[f-1]},rect:function(e,f,d,a){var c,b;this.moveTo(e,f);c=this.paths[this.cp];b=this.matrix.applyToArray([e+d,f,e+d,f+a,e,f+a]);c.add(b[0],b[1]);c.add(b[2],b[3]);c.add(b[4],b[5]);this.closePath();this.cx=b[0];this.cy=b[1]},quadraticCurveTo:function(a,b,n,o){var f=this.paths[this.cp],c=f.points.length,h=c>1?this.cx:a,i=c>1?this.cy:b,g=this.step,d=this.matrix,e,j=g;for(;j<1;j+=g){var k=(1-j);e=d.applyToPoint(k*k*h+2*k*j*a+j*j*n,k*k*i+2*k*j*b+j*j*o);f.add(e.x,e.y)}e=d.applyToPoint(n,o);f.add(e.x,e.y);this.cx=n;this.cy=o},bezierCurveTo:function(a,c,b,d,s,u){var h=this.paths[this.cp],e=h.points.length,j=e>1?this.cx:a,k=e>1?this.cy:c,i=this.step,f=this.matrix,g,n=i,o,q,r;for(;n<1;n+=i){o=1-n;q=o*o;r=n*n*3*o;g=f.applyToPoint(q*o*j+n*3*q*a+r*b+n*n*n*s,q*o*k+n*3*q*c+r*d+n*n*n*u);h.add(g.x,g.y)}g=f.applyToPoint(s,u);h.add(g.x,g.y);this.cx=s;this.cy=u}};_8bit.Path2D.Path=function(a){this.points=a?a.concat():[];this.isClosed=!1};_8bit.Path2D.Path.prototype={add:function(a,b){this.points.push(a,b)},concat:function(b){this.points=this.points.concat(b)}};_8bit.Matrix=function(a){var b=this;b._t=b.transform;b.a=b.d=1;b.b=b.c=b.e=b.f=0;if(a){(b.context=a).setTransform(1,0,0,1,0,0)}};_8bit.Matrix.fromSVGMatrix=function(b,a){return new _8bit.Matrix(a).multiply(svgCanvas8BitContext.Matrix)};_8bit.Matrix.from=function(g,h,i,k,l,m,j){return new _8bit.Matrix(j).setTransform(g,h,i,k,l,m)};_8bit.Matrix.prototype={concat:function(a){return this.clone().multiply(a)},flipX:function(){return this._t(-1,0,0,1,0,0)},flipY:function(){return this._t(1,0,0,-1,0,0)},reflectVector:function(c,e){var b=this.applyToPoint(0,1),a=(b.x*c+b.y*e)*2;c-=a*b.x;e-=a*b.y;return{x:c,y:e}},reset:function(){return this.setTransform(1,0,0,1,0,0)},rotate:function(a){var b=Math.cos(a),c=Math.sin(a);return this._t(b,c,-c,b,0,0)},rotateFromVector:function(a,b){return this.rotate(Math.atan2(b,a))},rotateDeg:function(a){return this.rotate(a*Math.PI/180)},scaleU:function(a){return this._t(a,0,0,a,0,0)},scale:function(a,b){return this._t(a,0,0,b,0,0)},scaleX:function(a){return this._t(a,0,0,1,0,0)},scaleY:function(a){return this._t(1,0,0,a,0,0)},shear:function(a,b){return this._t(1,b,a,1,0,0)},shearX:function(a){return this._t(1,0,a,1,0,0)},shearY:function(a){return this._t(1,a,0,1,0,0)},skew:function(a,b){return this.shear(Math.tan(a),Math.tan(b))},skewDeg:function(a,b){return this.shear(Math.tan(a/180*Math.PI),Math.tan(b/180*Math.PI))},skewX:function(a){return this.shearX(Math.tan(a))},skewY:function(a){return this.shearY(Math.tan(a))},setTransform:function(g,h,i,j,k,l){var m=this;m.a=g;m.b=h;m.c=i;m.d=j;m.e=k;m.f=l;return m._x()},translate:function(a,b){return this._t(1,0,0,1,a,b)},translateX:function(a){return this._t(1,0,0,1,a,0)},translateY:function(a){return this._t(1,0,0,1,0,a)},transform:function(b,d,f,h,j,l){var m=this,a=m.a,c=m.b,e=m.c,g=m.d,i=m.e,k=m.f;m.a=a*b+e*d;m.b=c*b+g*d;m.c=a*f+e*h;m.d=c*f+g*h;m.e=a*j+e*l+i;m.f=c*j+g*l+k;return m._x()},multiply:function(a){return this._t(a.a,a.b,a.c,a.d,a.e,a.f)},divide:function(a){if(!a.isInvertible()){throw"_8bit.Matrix not invertible"}return this.multiply(a.inverse())},divideScalar:function(a){var b=this;b.a/=a;b.b/=a;b.c/=a;b.d/=a;b.e/=a;b.f/=a;return b._x()},inverse:function(a){var d=this,c=new _8bit.Matrix(a?d.context:null),b=d.determinant();if(d._q(b,0)){throw"_8bit.Matrix not invertible."}c.a=d.d/b;c.b=-d.b/b;c.c=-d.c/b;c.d=d.a/b;c.e=(d.c*d.f-d.d*d.e)/b;c.f=-(d.a*d.f-d.b*d.e)/b;return c},interpolate:function(c,e,a){var d=this,b=a?new _8bit.Matrix(a):new _8bit.Matrix();b.a=d.a+(c.a-d.a)*e;b.b=d.b+(c.b-d.b)*e;b.c=d.c+(c.c-d.c)*e;b.d=d.d+(c.d-d.d)*e;b.e=d.e+(c.e-d.e)*e;b.f=d.f+(c.f-d.f)*e;return b._x()},interpolateAnim:function(e,j,a){var d=new _8bit.Matrix(a?a:null),b=this.decompose(),c=e.decompose(),k=b.translate,l=c.translate,g=b.scale,f=b.rotation+(c.rotation-b.rotation)*j,n=k.x+(l.x-k.x)*j,o=k.y+(l.y-k.y)*j,h=g.x+(c.scale.x-g.x)*j,i=g.y+(c.scale.y-g.y)*j;d.translate(n,o);d.rotate(f);d.scale(h,i);return d._x()},decompose:function(w){var l=this,e=l.a,h=l.b,i=l.c,j=l.d,f=Math.acos,g=Math.atan,u=Math.sqrt,m=Math.PI,v={x:l.e,y:l.f},o=0,q={x:1,y:1},t={x:0,y:0},k=e*j-h*i;if(w){if(e){t={x:g(i/e),y:g(h/e)};q={x:e,y:k/e}}else{if(h){o=m*0.5;q={x:h,y:k/h};t.x=g(j/h)}else{q={x:i,y:j};t.x=m*0.25}}}else{if(e||h){var n=u(e*e+h*h);o=h>0?f(e/n):-f(e/n);q={x:n,y:k/n};t.x=g((e*i+h*j)/(n*n))}else{if(i||j){var p=u(i*i+j*j);o=m*0.5-(j>0?f(-i/p):-f(i/p));q={x:k/p,y:p};t.y=g((e*i+h*j)/(p*p))}else{q={x:0,y:0}}}}return{translate:v,rotation:o,scale:q,skew:t}},determinant:function(){return this.a*this.d-this.b*this.c},applyToPoint:function(b,c){var a=this;return{x:Math.round(b*a.a+c*a.c+a.e),y:Math.round(b*a.b+c*a.d+a.f)}},applyToArray:function(e){var a=0,d,b,c=[];b=e.length;if(this.isIdentity()){while(a<b){c.push((e[a++]+0.5)|0,(e[a++]+0.5)|0)}}else{while(a<b){d=this.applyToPoint(e[a++],e[a++]);c.push((d.x+0.5)|0,(d.y+0.5)|0)}}return c},applyToContext:function(a){var b=this;a.setTransform(b.a,b.b,b.c,b.d,b.e,b.f);return b},isIdentity:function(){var a=this;return a._q(a.a,1)&&a._q(a.b,0)&&a._q(a.c,0)&&a._q(a.d,1)&&a._q(a.e,0)&&a._q(a.f,0)},isInvertible:function(){return !this._q(this.determinant(),0)},isValid:function(){return !(this.a*this.d)},isEqual:function(a){var b=this,c=b._q;return c(b.a,a.a)&&c(b.b,a.b)&&c(b.c,a.c)&&c(b.d,a.d)&&c(b.e,a.e)&&c(b.f,a.f)},clone:function(a){if(a){this.a=a.a;this.b=a.b;this.c=a.c;this.d=a.d;this.e=a.e;this.f=a.f}else{return new _8bit.Matrix().multiply(this)}},toArray:function(){var a=this;return[a.a,a.b,a.c,a.d,a.e,a.f]},toTypedArray:function(d){var b=d?new Float64Array(6):new Float32Array(6),c=this;b[0]=c.a;b[1]=c.b;b[2]=c.c;b[3]=c.d;b[4]=c.e;b[5]=c.f;return b},toCSS:function(){return"_8bit.Matrix("+this.toArray()+")"},toCSS3D:function(){var a=this;return"_8bit.Matrix3d("+a.a+","+a.b+",0,0,"+a.c+","+a.d+",0,0,0,0,1,0,"+a.e+","+a.f+",0,1)"},toJSON:function(){var a=this;return'{"a":'+a.a+',"b":'+a.b+',"c":'+a.c+',"d":'+a.d+',"e":'+a.e+',"f":'+a.f+"}"},toString:function(a){var b=this;a=a||4;return"a="+b.a.toFixed(a)+" b="+b.b.toFixed(a)+" c="+b.c.toFixed(a)+" d="+b.d.toFixed(a)+" e="+b.e.toFixed(a)+" f="+b.f.toFixed(a)},_q:function(a,b){return Math.abs(a-b)<1e-14},_x:function(){var a=this;if(a.context){a.context.setTransform(a.a,a.b,a.c,a.d,a.e,a.f)}return a}};_8bit.Image=function(e,b,a){var d=this,c=new Image;this.onload=null;this.onerror=null;this.bitmap=null;this.width=0;this.height=0;this.naturalWidth=0;this.naturalHeight=0;this.palette=a.palette;c.onload=function(f){d.width=d.naturalWidth=e=e?e:c.naturalWidth||c.width;d.height=d.naturalHeight=b=b?b:c.naturalHeight||c.height;d.bitmap=_8bit.Image.convert(c,e,b,a);if(d.onload){(d.onload.bind(d))(f)}};c.onerror=function(f){if(d.onerror){(d.onerror.bind(d))(f)}};c.onabort=function(f){if(d.onabort){d.onabort(f)}};Object.defineProperty(this,"src",{get:function(){return c.src},set:function(f){c.src=f}});Object.defineProperty(this,"crossOrigin",{get:function(){return c.crossOrigin},set:function(f){c.crossOrigin=f}})};_8bit.Image.convert=function(s,B,o,f){var e=_8bit.utils.getContext(B,o),r,b,c,t,d=[],k,C,D,z,E,v,g,A=f.palette,u=f.imageSmoothingQuality,q=0,n=[l,m,j],a=[0.0176,0.1588,0.053,0.1941,0.2294,0.0882,0.2647,0.1235,0.0706,0.2118,0.0353,0.1765,0.2824,0.1412,0.2471,0.1059];k=["low","medium","high"].indexOf(u);e.drawImage(s,0,0,B,o);r=e.getImageData(0,0,B,o);b=r.data;t=b.length;c=new Uint32Array(r.data.buffer);if(!f.imageSmoothingEnabled||k<0){while(q<t){c[q++]=A.getNearestColor(new _8bit.Color(c[q])).int32}}else{for(D=0;D<o;D++){d.push([]);for(C=0,E=d[D];C<B;C++){z=D*B+C;E.push(new _8bit.Color(c[z]))}}g=n[k];for(D=0,z=0;D<o;D++){for(C=0;C<B;C++){v=g(d,A,C,D,B,o);c[z++]=v.int32}}}function j(i,J,L,O,K,G){var I=i[O][L],H=J.getNearestColor(I),F=I.sub(H),N=L+1,P=O+1,M,p;if(N<K){i[O][N]=i[O][N].add(F.mul(0.4375))}if(P<G){M=L-1;p=i[P];p[L]=p[L].add(F.mul(0.3125));if(M>=0){p[M]=p[M].add(F.mul(0.1875))}if(N<K){p[N]=p[N].add(F.mul(0.0625))}}return H}function m(i,J,L,O,K,G){var I=i[O][L],H=J.getNearestColor(I),F=I.sub(H),N=L+1,M=L-1,P=O+1,p=i[P];if(N<K){i[O][N]=i[O][N].add(F.mul(0.5))}if(P<G){p[L]=p[L].add(F.mul(0.25));if(M>=0){p[M]=p[M].add(F.mul(0.25))}}return H}function l(h,w,G,H){var p=h[H][G],F=((H%4)<<2)+(G%4),i=a[F];return w.getNearestColor(new _8bit.Color(p.r+(p.r*i&255),p.g+(p.g*i&255),p.b+(p.b*i&255)))}return r};_8bit.Shaders.Pixelated=function(d,a,c){var b=this;this.ctx=_8bit.utils.getContext(d,a,!!c);this.canvas=this.ctx.canvas;this.width=d;this.height=a;_8bit.utils.disableSmoothing(b.ctx)};_8bit.Shaders.Pixelated.prototype={drawToCtx:function(a,c,b){if(c&&b){a.drawImage(this.canvas,0,0,c,b)}else{a.drawImage(this.canvas,0,0)}},drawToRender:function(b,c,a){this.drawToCtx(b.ctx,c,a)},clearRect:function(d,e,c,a,b){if(b){b.matrix.applyToContext(this.ctx)}this.ctx.fillStyle=b.styles[2].color.toStyle();this.ctx.fillRect(d,e,c,a);this.ctx.setTransform(1,0,0,1,0,0)},stroke:function(k,q,b){var u=this.width,d=this.height,f=this.ctx.createImageData(u,d),a=new Uint32Array(f.data.buffer),r=q.styles[0],o,c,l,j,e,s;switch(r.type){case _8bit.Style.type.solid:o=r.style;c=m;break;case _8bit.Style.type.pattern:o=r.original;c=n;break;case _8bit.Style.type.gradient:o=r.original;c=n;o._generate(b);break}for(e=0;j=k[e++];){l=j.points;if(l.length>1){for(s=2;s<l.length;s+=2){g(l[s-2],l[s-1],l[s],l[s+1])}if(j.isClosed){g(l[l.length-2],l[l.length-1],l[0],l[1])}}}this.ctx.putImageData(f,0,0);function m(h,i){if(h>=0&&h<u&&i>=0&&i<d){a[i*u+h]=o}}function n(h,i){if(h>=0&&h<u&&i>=0&&i<d){a[i*u+h]=o._getPixel(h,i)}}function g(z,B,A,C){var h,w,x=C-B,t=A-z,D=!1,v=t>>31,y=x>>31,p;if((x^y)-y>(t^v)-v){x^=t;t^=x;x^=t;D=!0}h=t<0?-1:1;w=(t===0)?x:x/t;if(D){z+=0.5;for(p=0;p!==t;p+=h){c((z+p*w)|0,B+p)}}else{B+=0.5;for(p=0;p!==t;p+=h){c(z+p,(B+p*w)|0)}}}},fill:function(k,q,b,s){var t=this.width,f=this.height,j=this.ctx.createImageData(t,f),a=new Uint32Array(j.data.buffer),r=q.styles[1],p,c,l,m,g;switch(r.type){case _8bit.Style.type.solid:p=r.style;c=o;break;case _8bit.Style.type.pattern:p=r.original;c=n;break;case _8bit.Style.type.gradient:p=r.original;c=n;p._generate(b);break}for(g=0;g<k.length;g++){l=k[g].points;m=e(l);c(m)}this.ctx.putImageData(j,0,0);function o(w){var h=0,v;while(v=w[h++]){for(var u,z=Math.max(0,v.x1),B=v.y,A=Math.min(t,v.x2);z<A;z++){u=B*t+z;a[u]^=p}}}function n(z){var u=0,w,h=p._getPixel;while(w=z[u++]){for(var v,A=Math.max(0,w.x1),C=w.y,B=Math.min(t,w.x2);A<B;A++){v=C*t+A;a[v]=a[v]?0:h(A,C)}}}function e(){var h=l.length,v=[],u,i,x,w;for(x=0.25;x<f;x++){u=[];for(w=0;w<h-3;w+=2){if((l[w+1]<=x&&l[w+3]>=x)||(l[w+3]<=x&&l[w+1]>=x)){i=d(-65535,x,65535,l[w]+0.5,l[w+1],l[w+2]+0.5,l[w+3]);if(i){u.push(i)}}}i=d(-65535,x,65535,l[h-2]+0.5,l[h-1],l[0]+0.5,l[1]);if(i){u.push(i)}if(u.length>1){u.sort(function(y,z){return y.x-z.x});for(w=0;w<u.length-1;w+=2){v.push({x1:Math.max(0,Math.min(t,Math.round(u[w].x))),x2:Math.max(0,Math.min(t,Math.round(u[w+1].x))),y:u[w].y|0})}}}return v}function d(w,x,y,z,A,B,C){if((A|0)===(C|0)){return null}var i=y-w,u=B-z,v=C-A,h=i*v,D,E,F,G;if(h===0){return null}E=x-A;F=(i*E)/h;if(F>=0&&F<=1){D=w-z;G=(u*E-v*D)/h;if(G>=0&&G<=1){return{x:w+(G*i),y:x}}}return null}},drawImage:function(k,l,b,c){var q=this.width,d=this.height,m=k.width,i=k.height,e=this.ctx.createImageData(q,d),a=new Uint32Array(e.data.buffer),j=new Uint32Array(k.data.buffer),f=l.matrix.inverse(),r,s,g,n,o;if(f.isIdentity()){for(s=0;s<d;s++){for(r=0;r<q;r++){n=r-b;o=s-c;if(n>=0&&n<m&&n>=0&&o<i){a[s*q+r]=j[o*m+n]}}}}else{for(s=0;s<d;s++){for(r=0;r<q;r++){g=f.applyToPoint(r,s);n=Math.round(g.x)-b;o=Math.round(g.y)-c;if(n>=0&&n<m&&n>=0&&o<i){a[s*q+r]=j[o*m+n]}}}}this.ctx.putImageData(e,0,0)}};